---
$schema: 'https://json-schema.org/draft/2019-09/schema'
$defs:
  Error:
    $comment: this is the superset of all error schemas
    type: object
    additionalProperties: false
    required: [ error ]
    properties:
      error:
        type: string
  ValidationError:
    $comment: base structure for all query_param, request, response validation error responses
    type: object
    additionalProperties: false
    required: [ error, details, schema ]
    properties:
      error:
        type: string
        pattern: ' did not match required format$'
      details:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          $ref: '#/$defs/JSONSchemaError'
      schema:
        type: string
        format: uri
        pattern: '/json_schema/[^/.~]+/[A-Za-z0-9_-]+$'
      data:
        $comment: any supplementary details will be included here
  QueryParamsValidationError:
    $ref: '#/$defs/ValidationError'
    type: object
    unevaluatedProperties: false
    required: [ error, schema, data ]
    properties:
      error:
        type: string
        const: query parameters did not match required format
      schema:
        pattern: '/json_schema/query_params/[A-Za-z0-9_-]+$'
      data:
        $comment: the parsed form of the query parameters, as they were passed to the schema for validation
        type: object
        additionalProperties:
          type: [ string, array ]
          minItems: 2
          items:
            type: string
  RequestValidationError:
    $ref: '#/$defs/ValidationError'
    type: object
    unevaluatedProperties: false
    required: [ error, schema ]
    properties:
      error:
        type: string
        const: request did not match required format
      schema:
        pattern: '/json_schema/request/[A-Za-z0-9_-]+$'
  JSONSchemaError:
    $comment: very similar to https://json-schema.org/draft/2019-09/output/schema#/$defs/outputUnit - see https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.10.4.2
    type: object
    required: [ data_location, schema_location, error ]
    additionalProperties: false
    properties:
      data_location:
        type: string
        format: json-pointer
      schema_location:
        type: string
        format: json-pointer
      absolute_schema_location:
        type: string
        format: uri
      error:
        $ref: common.yaml#/$defs/non_empty_string
  JSONSchemaErrors:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/JSONSchemaError'
  Ping:
    type: object
    additionalProperties: false
    required: [ status ]
    properties:
      status:
        const: ok
  LoginToken:
    type: object
    additionalProperties: false
    required: [ jwt_token ]
    properties:
      jwt_token:
        type: string
        pattern: '^[^.]+\.[^.]+\.[^.]+$'
        contentMediaType: application/jwt
  DetailedDevice:
    type: object
    additionalProperties: false
    required:
      - id
      - serial_number
      - asset_tag
      - created
      - hardware_product_id
      - sku
      - health
      - hostname
      - last_seen
      - system_uuid
      - updated
      - uptime_since
      - validated
      - phase
      - links
      - build_id
      - build_name
      - latest_report
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      serial_number:
        $ref: common.yaml#/$defs/device_serial_number
      asset_tag:
        oneOf:
          - $ref: common.yaml#/$defs/device_asset_tag
          - type: 'null'
      created:
        type: string
        format: date-time
      hardware_product_id:
        $ref: common.yaml#/$defs/uuid
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      health:
        $ref: common.yaml#/$defs/device_health
      hostname:
        type: [ 'null', string ]
      last_seen:
        type: [ 'null', string ]
        format: date-time
      system_uuid:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/uuid
      updated:
        type: string
        format: date-time
      uptime_since:
        type: [ 'null', string ]
        format: date-time
      validated:
        type: [ 'null', string ]
        format: date-time
      phase:
        $ref: common.yaml#/$defs/device_phase
      links:
        $ref: common.yaml#/$defs/links
      build_id:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/uuid
      build_name:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/mojo_standard_placeholder
      location:
        $comment: location is included only when device 'phase' is earlier than 'production'
        oneOf:
          - $ref: '#/$defs/DeviceLocation'
          - type: 'null'
      nics: # NOTE: see also DeviceNic
        $comment: nics is included only when device 'phase' is earlier than 'production'
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required:
            - mac
            - iface_name
            - iface_vendor
            - peer_mac
            - peer_port
            - peer_switch
          properties:
            mac:
              $ref: common.yaml#/$defs/macaddr
            iface_name:
              $ref: common.yaml#/$defs/device_interface_name
            iface_vendor:
              type: string
            iface_type:
              type: string
            peer_mac:
              type: [ 'null', string ]
            peer_port:
              type: [ 'null', string ]
            peer_switch:
              type: [ 'null', string ]
      disks:
        $comment: disks is included only when device 'phase' is earlier than 'production'
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required:
            - id
            - serial_number
            - slot
            - size
            - vendor
            - model
            - firmware
            - transport
            - health
            - drive_type
            - enclosure
            - created
            - updated
          properties:
            id:
              $ref: common.yaml#/$defs/uuid
            serial_number:
              $ref: common.yaml#/$defs/disk_serial_number
            slot:
              oneOf:
                - $ref: common.yaml#/$defs/non_negative_integer
                - type: 'null'
            size:
              oneOf:
                - $ref: common.yaml#/$defs/non_negative_integer
                - type: 'null'
            vendor:
              type: [ 'null', string ]
            model:
              type: [ 'null', string ]
            firmware:
              type: [ 'null', string ]
            transport:
              type: [ 'null', string ]
            health:
              type: [ 'null', string ]
            drive_type:
              type: [ 'null', string ]
            enclosure:
              type: [ 'null', integer ]
            hba:
              type: [ 'null', integer ]
            created:
              type: string
              format: date-time
            updated:
              type: string
              format: date-time
      latest_report:
        $comment: the contents of the device report. Given its age we cannot provide a schema.
        type: [ 'null', object ]
    if:
      properties:
        phase:
          enum: [ integration, installation ]
    then:
      required: [ location, nics, disks ]
    else:
      properties:
        location: false
        nics: false
        disks: false
  DeviceIds:
    type: array
    uniqueItems: true
    items:
      $ref: common.yaml#/$defs/uuid
  DeviceSerials:
    type: array
    uniqueItems: true
    items:
      $ref: common.yaml#/$defs/device_serial_number
  Devices:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/Device'
  Device:
    type: object
    additionalProperties: false
    required:
      - id
      - serial_number
      - asset_tag
      - created
      - hardware_product_id
      - sku
      - health
      - hostname
      - last_seen
      - system_uuid
      - updated
      - uptime_since
      - validated
      - phase
      - links
      - build_id
      - build_name
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      serial_number:
        $ref: common.yaml#/$defs/device_serial_number
      asset_tag:
        oneOf:
          - $ref: common.yaml#/$defs/device_asset_tag
          - type: 'null'
      created:
        type: string
        format: date-time
      hardware_product_id:
        $ref: common.yaml#/$defs/uuid
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      health:
        $ref: common.yaml#/$defs/device_health
      hostname:
        type: [ 'null', string ]
      last_seen:
        type: [ 'null', string ]
        format: date-time
      system_uuid:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/uuid
      updated:
        type: string
        format: date-time
      uptime_since:
        type: [ 'null', string ]
        format: date-time
      validated:
        type: [ 'null', string ]
        format: date-time
      phase:
        $ref: common.yaml#/$defs/device_phase
      links:
        $ref: common.yaml#/$defs/links
      build_id:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/uuid
      build_name:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/mojo_standard_placeholder
      rack_id:
        oneOf:
          - $ref: common.yaml#/$defs/uuid
          - type: 'null'
      rack_name:
        $comment: rack.full_rack_name (datacenter_room.vendor_name + ':' + rack.name)
        oneOf:
          - $ref: common.yaml#/$defs/mojo_relaxed_placeholder
          - type: 'null'
      rack_unit_start:
        oneOf:
          - $ref: common.yaml#/$defs/positive_integer
          - type: 'null'
    if:
      properties:
        phase:
          enum: [ integration, installation ]
    then:
      required: [ rack_id, rack_name, rack_unit_start ]
    else:
      properties:
        rack_id: false
        rack_name: false
        rack_unit_start: false
  DeviceNics:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/DeviceNic'
  DeviceNic:
    $ref: '#/$defs/DeviceNicFields'
    type: object
    unevaluatedProperties: false
    required:
      - device_id
      - mac
      - iface_name
      - iface_vendor
      - state
      - ipaddr
      - mtu
  DeviceNicFields:
    type: object
    additionalProperties: false
    properties:
      device_id:
        $ref: common.yaml#/$defs/uuid
      mac:
        $ref: common.yaml#/$defs/macaddr
      iface_name:
        $ref: common.yaml#/$defs/device_interface_name
      iface_vendor:
        type: string
      iface_type:
        type: string
      state:
        type: [ 'null', string ]
      ipaddr:
        oneOf:
          - $ref: common.yaml#/$defs/ipaddr
          - type: 'null'
      mtu:
        type: [ 'null', integer ]
  DeviceNicField:
    $ref: '#/$defs/DeviceNicFields'
    unevaluatedProperties: false
    type: object
    minProperties: 1
    maxProperties: 1
    properties:
      device_id: false
  DevicePXE:
    type: object
    additionalProperties: false
    required: [ id, phase, ipmi, pxe ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      phase:
        $ref: common.yaml#/$defs/device_phase
      location:
        oneOf:
          - type: 'null'
          - $ref: '#/$defs/DeviceLocation'
      ipmi:
        type: [ 'null', object ]
        additionalProperties: false
        required: [ mac, ip ]
        properties:
          mac:
            $ref: common.yaml#/$defs/macaddr
          ip:
            oneOf:
              - type: 'null'
              - $ref: common.yaml#/$defs/ipaddr
      pxe:
        type: [ 'null', object ]
        additionalProperties: false
        required: [ mac ]
        properties:
          mac:
            $ref: common.yaml#/$defs/macaddr
    if:
      properties:
        phase:
          enum: [ integration, installation ]
    then:
      required: [ location ]
    else:
      properties:
        location: false
  DevicePXEs:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/DevicePXE'
  DevicePhase:
    type: object
    additionalProperties: false
    required: [ id, phase ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      phase:
        $ref: common.yaml#/$defs/device_phase
  DeviceSku:
    type: object
    additionalProperties: false
    required: [ id, hardware_product_id, sku ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      hardware_product_id:
        $ref: common.yaml#/$defs/uuid
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
  DeviceLocation:
    type: object
    additionalProperties: false
    required:
      - az
      - datacenter_room
      - rack
      - rack_unit_start
      - target_hardware_product
    properties:
      az:
        type: string
      datacenter_room:
        $comment: datacenter_room.alias
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      rack:
        $comment: rack.full_rack_name (datacenter_room.vendor_name + ':' + rack.name)
        $ref: common.yaml#/$defs/mojo_relaxed_placeholder
      rack_unit_start:
        $ref: common.yaml#/$defs/positive_integer
      target_hardware_product:
        $comment: Details of the hardware product the device is expected to be based on its current position and the rack layout.
        type: object
        additionalProperties: false
        required:
          - id
          - name
          - alias
          - sku
          - hardware_vendor_id
        properties:
          id:
            $comment: hardware product ID
            $ref: common.yaml#/$defs/uuid
          name:
            $comment: Hardware product name
            type: string
          alias:
            $comment: Hardware product alias
            type: string
          sku:
            $ref: common.yaml#/$defs/mojo_standard_placeholder
          hardware_vendor_id:
            $ref: common.yaml#/$defs/uuid
  DeviceSetting:
    $ref: '#/$defs/DeviceSettings'
    maxProperties: 1
  DeviceSettings:
    type: object
    propertyNames:
      $ref: common.yaml#/$defs/setting_key
    additionalProperties:
      type: string
  HardwareProducts:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - name
        - alias
        - generation_name
        - sku
        - created
        - updated
      properties:
        id:
          $ref: common.yaml#/$defs/uuid
        name:
          $ref: common.yaml#/$defs/mojo_standard_placeholder
        alias:
          $ref: common.yaml#/$defs/mojo_standard_placeholder
        generation_name:
          type: [ 'null', string ]
        sku:
          $ref: common.yaml#/$defs/mojo_standard_placeholder
        created:
          type: string
          format: date-time
        updated:
          type: string
          format: date-time
  HardwareProduct:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - alias
      - prefix
      - hardware_vendor_id
      - generation_name
      - legacy_product_name
      - sku
      - specification
      - rack_unit_size
      - created
      - updated
      - validation_plan_id
      - bios_firmware
      - cpu_num
      - cpu_type
      - dimms_num
      - hba_firmware
      - nics_num
      - psu_total
      - purpose
      - ram_total
      - sas_hdd_num
      - sas_hdd_size
      - sas_hdd_slots
      - sata_hdd_num
      - sata_hdd_size
      - sata_hdd_slots
      - sata_ssd_num
      - sata_ssd_size
      - sata_ssd_slots
      - sas_ssd_num
      - sas_ssd_size
      - sas_ssd_slots
      - nvme_ssd_num
      - nvme_ssd_size
      - nvme_ssd_slots
      - raid_lun_num
      - usb_num
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      alias:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      prefix:
        type: [ 'null', string ]
      hardware_vendor_id:
        $ref: common.yaml#/$defs/uuid
      generation_name:
        type: [ 'null', string ]
      legacy_product_name:
        type: [ 'null', string ]
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      specification:
        oneOf:
          - $ref: common.yaml#/$defs/HardwareProductSpecification
          - type: 'null'
      rack_unit_size:
        $ref: common.yaml#/$defs/positive_integer
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
      validation_plan_id:
        $comment: this property will become nullable in v3.3 and removed in v4.0
        deprecated: true
        $ref: common.yaml#/$defs/uuid
      bios_firmware:
        type: string
      cpu_num:
        type: integer
      cpu_type:
        type: string
      dimms_num:
        type: integer
      hba_firmware:
        type: [ 'null', string ]
      nics_num:
        type: integer
      psu_total:
        type: integer
      purpose:
        type: string
      ram_total:
        type: integer
      sas_hdd_num:
        type: integer
      sas_hdd_size:
        type: [ 'null', integer ]
      sas_hdd_slots:
        type: [ 'null', string ]
      sata_hdd_num:
        type: integer
      sata_hdd_size:
        type: [ 'null', integer ]
      sata_hdd_slots:
        type: [ 'null', string ]
      sata_ssd_num:
        type: integer
      sata_ssd_size:
        type: [ 'null', integer ]
      sata_ssd_slots:
        type: [ 'null', string ]
      sas_ssd_num:
        type: integer
      sas_ssd_size:
        type: [ 'null', integer ]
      sas_ssd_slots:
        type: [ 'null', string ]
      nvme_ssd_num:
        type: integer
      nvme_ssd_size:
        type: [ 'null', integer ]
      nvme_ssd_slots:
        type: [ 'null', string ]
      raid_lun_num:
        type: integer
      usb_num:
        type: integer
  LegacyValidations:
    $comment: this definition will be removed in v4.0
    deprecated: true
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/LegacyValidation'
  LegacyValidation:
    $comment: this definition will be removed in v4.0
    deprecated: true
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - version
      - description
      - created
      - updated
      - deactivated
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      version:
        $ref: common.yaml#/$defs/positive_integer
      description:
        type: string
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
      deactivated:
        oneOf:
          - type: 'null'
          - type: string
            format: date-time
  LegacyValidationPlans:
    $comment: this definition will be removed in v4.0
    deprecated: true
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/LegacyValidationPlan'
  LegacyValidationPlan:
    $comment: this definition will be removed in v4.0
    deprecated: true
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - description
      - created
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      description:
        type: string
      created:
        type: string
        format: date-time
  LegacyValidationResult:
    type: object
    additionalProperties: false
    required:
      - id
      - category
      - component
      - hint
      - message
      - status
      - validation_id
      - name
      - version
      - description
    properties:
      id:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/uuid
      category:
        type: string
      component:
        type: [ 'null', string ]
      hint:
        type: [ 'null', string ]
      message:
        type: string
      status:
        $ref: common.yaml#/$defs/validation_status
      validation_id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      version:
        $ref: common.yaml#/$defs/positive_integer
      description:
        type: string
  LegacyValidationResults:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/LegacyValidationResult'
  ValidationStateWithResults:
    type: object
    additionalProperties: false
    required:
      - id
      - created
      - device_id
      - results
      - status
      - hardware_product_id
      - device_report_id
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      created:
        type: string
        format: date-time
      device_id:
        $ref: common.yaml#/$defs/uuid
      results:
        type: array
        uniqueItems: true
        items:
          $ref: '#/$defs/LegacyValidationResult'
      status:
        $ref: common.yaml#/$defs/validation_status
      hardware_product_id:
        $ref: common.yaml#/$defs/uuid
      device_report_id:
        $ref: common.yaml#/$defs/uuid
  ReportValidationResults:
    type: object
    additionalProperties: false
    required:
      - device_serial_number
      - hardware_product_id
      - sku
      - status
      - results
    properties:
      device_serial_number:
        $ref: common.yaml#/$defs/device_serial_number
      hardware_product_id:
        $ref: common.yaml#/$defs/uuid
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      status:
        $ref: common.yaml#/$defs/validation_status
      results:
        $ref: '#/$defs/LegacyValidationResults'
  Datacenters:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/Datacenter'
  Datacenter:
    type: object
    additionalProperties: false
    required:
      - id
      - vendor
      - vendor_name
      - region
      - location
      - created
      - updated
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      vendor:
        type: string
      vendor_name:
        $comment: the vendor's name for the datacenter
        type: [ 'null', string ]
      region:
        type: string
      location:
        type: string
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  DatacenterRoomsDetailed:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/DatacenterRoomDetailed'
  DatacenterRoomDetailed:
    type: object
    additionalProperties: false
    required:
      - id
      - az
      - alias
      - vendor_name
      - datacenter_id
      - created
      - updated
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      az:
        type: string
      alias:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      vendor_name:
        $comment: the vendor's name for the room
        $ref: common.yaml#/$defs/mojo_relaxed_placeholder
      datacenter_id:
        $ref: common.yaml#/$defs/uuid
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  Relays:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/Relay'
  Relay:
    type: object
    additionalProperties: false
    required:
      - id
      - serial_number
      - name
      - version
      - ipaddr
      - ssh_port
      - created
      - updated
      - last_seen
      - user_id
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      serial_number:
        $ref: common.yaml#/$defs/relay_serial_number
      name:
        type: [ 'null', string ]
      created:
        type: string
        format: date-time
      ipaddr:
        oneOf:
          - $ref: common.yaml#/$defs/ipaddr
          - type: 'null'
      ssh_port:
        oneOf:
          - $ref: common.yaml#/$defs/non_negative_integer
          - type: 'null'
      updated:
        type: string
        format: date-time
      last_seen:
        type: string
        format: date-time
      version:
        type: [ 'null', string ]
      user_id:
        $ref: common.yaml#/$defs/uuid
  Version:
    type: object
    additionalProperties: false
    required: [ version ]
    properties:
      version:
        type: string
  Racks:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/Rack'
  Rack:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - full_rack_name
      - datacenter_room_id
      - datacenter_room_alias
      - rack_role_id
      - rack_role_name
      - serial_number
      - asset_tag
      - phase
      - created
      - updated
      - build_id
      - build_name
      - links
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_relaxed_placeholder
      full_rack_name:
        $comment: rack.full_rack_name (datacenter_room.vendor_name + ':' + rack.name)
        $ref: common.yaml#/$defs/mojo_relaxed_placeholder
      datacenter_room_id:
        $ref: common.yaml#/$defs/uuid
      datacenter_room_alias:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      rack_role_id:
        $ref: common.yaml#/$defs/uuid
      rack_role_name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      serial_number:
        type: [ 'null', string ]
      asset_tag:
        oneOf:
          - $ref: common.yaml#/$defs/device_asset_tag
          - type: 'null'
      phase:
        $ref: common.yaml#/$defs/device_phase
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
      build_id:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/uuid
      build_name:
        oneOf:
          - type: 'null'
          - $ref: common.yaml#/$defs/mojo_standard_placeholder
      links:
        $ref: common.yaml#/$defs/links
  RackIds:
    type: array
    uniqueItems: true
    items:
      $ref: common.yaml#/$defs/uuid
  RackRole:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - rack_size
      - created
      - updated
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      rack_size:
        $ref: common.yaml#/$defs/positive_integer
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  RackRoles:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/RackRole'
  RackLayouts:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/RackLayout'
  RackLayout:
    type: object
    additionalProperties: false
    required:
      - id
      - rack_id
      - rack_name
      - hardware_product_id
      - sku
      - rack_unit_start
      - rack_unit_size
      - created
      - updated
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      rack_id:
        $ref: common.yaml#/$defs/uuid
      rack_name:
        $comment: rack.full_rack_name (datacenter_room.vendor_name + ':' + rack.name)
        $ref: common.yaml#/$defs/mojo_relaxed_placeholder
      hardware_product_id:
        $ref: common.yaml#/$defs/uuid
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      rack_unit_start:
        $ref: common.yaml#/$defs/positive_integer
      rack_unit_size:
        $ref: common.yaml#/$defs/positive_integer
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  RackAssignments:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/RackAssignment'
  RackAssignment:
    type: object
    additionalProperties: false
    required:
      - device_id
      - device_serial_number
      - device_asset_tag
      - hardware_product_name
      - sku
      - rack_unit_start
      - rack_unit_size
    properties:
      device_id:
        oneOf:
          - $ref: common.yaml#/$defs/uuid
          - type: 'null'
      device_serial_number:
        oneOf:
          - $ref: common.yaml#/$defs/device_serial_number
          - type: 'null'
      device_asset_tag:
        oneOf:
          - $ref: common.yaml#/$defs/device_asset_tag
          - type: 'null'
      hardware_product_name:
        type: string
      sku:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      rack_unit_start:
        $ref: common.yaml#/$defs/positive_integer
      rack_unit_size:
        $ref: common.yaml#/$defs/positive_integer
  NewUser:
    type: object
    additionalProperties: false
    required: [ id, email, name ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      email:
        $ref: common.yaml#/$defs/email_address
      name:
        type: string
  UserError:
    type: object
    additionalProperties: false
    required: [ error, user ]
    properties:
      error:
        type: string
      user:
        type: object
        additionalProperties: false
        required: [ id, email, name, created, deactivated ]
        properties:
          id:
            $ref: common.yaml#/$defs/uuid
          email:
            $ref: common.yaml#/$defs/email_address
          name:
            type: string
          created:
            type: string
            format: date-time
          deactivated:
            type: [ 'null', string ]
            format: date-time
  UserDetailed:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - email
      - created
      - last_login
      - last_seen
      - refuse_session_auth
      - force_password_change
      - is_admin
      - organizations
      - builds
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        type: string
      email:
        $ref: common.yaml#/$defs/email_address
      created:
        type: string
        format: date-time
      last_login:
        type: [ 'null', string ]
        format: date-time
      last_seen:
        type: [ 'null', string ]
        format: date-time
      refuse_session_auth:
        type: boolean
      force_password_change:
        type: boolean
      is_admin:
        type: boolean
      organizations:
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required: [ id, name, description, role ]
          properties:
            id:
              $ref: common.yaml#/$defs/uuid
            name:
              $ref: common.yaml#/$defs/mojo_standard_placeholder
            description:
              type: [ 'null', string ]
            role:
              $ref: common.yaml#/$defs/role
      builds:
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required: [ id, name, description, role ]
          properties:
            id:
              $ref: common.yaml#/$defs/uuid
            name:
              $ref: common.yaml#/$defs/mojo_standard_placeholder
            description:
              type: [ 'null', string ]
            role:
              $ref: common.yaml#/$defs/role
            role_via_organization_id:
              $ref: common.yaml#/$defs/uuid
  Users:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - name
        - email
        - created
        - last_login
        - last_seen
        - refuse_session_auth
        - force_password_change
        - is_admin
      properties:
        id:
          $ref: common.yaml#/$defs/uuid
        name:
          type: string
        email:
          $ref: common.yaml#/$defs/email_address
        created:
          type: string
          format: date-time
        last_login:
          type: [ 'null', string ]
          format: date-time
        last_seen:
          type: [ 'null', string ]
          format: date-time
        refuse_session_auth:
          type: boolean
        force_password_change:
          type: boolean
        is_admin:
          type: boolean
  UserSettings:
    type: object
    propertyNames:
      $ref: common.yaml#/$defs/setting_key
    additionalProperties:
      type: string
  UserSetting:
    $ref: '#/$defs/UserSettings'
    maxProperties: 1
  UserTokens:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/UserToken'
  UserToken:
    type: object
    additionalProperties: false
    required: [ name, created, last_used, expires, last_ipaddr ]
    properties:
      name:
        type: string
      created:
        type: string
        format: date-time
      last_used:
        type: [ 'null', string ]
        format: date-time
      expires:
        type: string
        format: date-time
      last_ipaddr:
        oneOf:
          - $ref: common.yaml#/$defs/ipaddr
          - type: 'null'
  NewUserToken:
    type: object
    additionalProperties: false
    required: [ token, created, last_used, expires, name ]
    properties:
      token:
        type: string
        pattern: '^[^.]+\.[^.]+\.[^.]+$'
      created:
        type: string
        format: date-time
      last_used:
        type: [ 'null', string ]
        format: date-time
      expires:
        type: string
        format: date-time
      name:
        type: string
  HardwareVendor:
    type: object
    additionalProperties: false
    required: [ id, name, created, updated ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      created:
        type: string
        format: date-time
      updated:
        type: string
        format: date-time
  HardwareVendors:
    type: array
    uniqueItems: true
    items:
      $ref: '#/$defs/HardwareVendor'
  DeviceReportRow:
    type: object
    additionalProperties: false
    required: [ id, device_id, report, created ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      device_id:
        $ref: common.yaml#/$defs/uuid
      report:
        $comment: the contents of the device report. Given its age we cannot provide a schema.
        type: [ 'null', object ]
      created:
        type: string
        format: date-time
  UserTerse:
    type: object
    additionalProperties: false
    required: [ id, name, email ]
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        type: string
      email:
        $ref: common.yaml#/$defs/email_address
  Organization:
    type: object
    additionalProperties: false
    required:
      - id
      - name
      - description
      - created
      - users
      - builds
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      description:
        type: [ 'null', string ]
      created:
        type: string
        format: date-time
      users:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          type: object
          additionalProperties: false
          required: [ id, name, email, role ]
          properties:
            id:
              $ref: common.yaml#/$defs/uuid
            name:
              type: string
            email:
              $ref: common.yaml#/$defs/email_address
            role:
              $ref: common.yaml#/$defs/role
        contains:
          type: object
          properties:
            role:
              const: admin
      builds:
        type: array
        uniqueItems: true
        items:
          type: object
          additionalProperties: false
          required: [ id, name, description, role ]
          properties:
            id:
              $ref: common.yaml#/$defs/uuid
            name:
              $ref: common.yaml#/$defs/mojo_standard_placeholder
            description:
              type: [ 'null', string ]
            role:
              $ref: common.yaml#/$defs/role
  Organizations:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required:
        - id
        - name
        - description
        - created
        - admins
        - builds
      properties:
        id:
          $ref: common.yaml#/$defs/uuid
        name:
          $ref: common.yaml#/$defs/mojo_standard_placeholder
        description:
          type: [ 'null', string ]
        created:
          type: string
          format: date-time
        admins:
          type: array
          uniqueItems: true
          minItems: 1
          items:
            $ref: '#/$defs/UserTerse'
        builds:
          type: array
          uniqueItems: true
          items:
            type: object
            additionalProperties: false
            required: [ id, name, description, role ]
            properties:
              id:
                $ref: common.yaml#/$defs/uuid
              name:
                $ref: common.yaml#/$defs/mojo_standard_placeholder
              description:
                type: [ 'null', string ]
              role:
                $ref: common.yaml#/$defs/role
  Build:
    type: object
    unevaluatedProperties: false
    required:
      - id
      - name
      - description
      - created
      - started
      - completed
      - completed_user
      - completed_status
      - admins
      - links
    properties:
      id:
        $ref: common.yaml#/$defs/uuid
      name:
        $ref: common.yaml#/$defs/mojo_standard_placeholder
      description:
        type: [ 'null', string ]
      created:
        type: string
        format: date-time
      started:
        type: [ 'null', string ]
        format: date-time
      admins:
        type: array
        uniqueItems: true
        minItems: 1
        items:
          $ref: '#/$defs/UserTerse'
      links:
        $ref: common.yaml#/$defs/links
      device_health:
        type: object
        minProperties: 4
        maxProperties: 4
        propertyNames:
          $ref: common.yaml#/$defs/device_health
        additionalProperties:
          $ref: common.yaml#/$defs/non_negative_integer
      device_phases:
        type: object
        minProperties: 5
        maxProperties: 5
        propertyNames:
          $ref: common.yaml#/$defs/device_phase
        additionalProperties:
          $ref: common.yaml#/$defs/non_negative_integer
      rack_phases:
        type: object
        minProperties: 5
        maxProperties: 5
        propertyNames:
          $ref: common.yaml#/$defs/device_phase
        additionalProperties:
          $ref: common.yaml#/$defs/non_negative_integer
    if:
      properties:
        completed:
          type: 'null'
    then:
      properties:
        completed_user:
          type: 'null'
        completed_status:
          type: 'null'
    else:
      properties:
        completed:
          type: string
          format: date-time
        completed_user:
          $ref: '#/$defs/UserTerse'
        completed_status:
          enum: [ 'failure', 'success' ]
  Builds:
    type: array
    uniqueItems: true
    items:
      type: object
      unevaluatedProperties: false
      required:
        - id
        - name
        - description
        - created
        - started
        - completed
        - completed_status
        - links
      properties:
        id:
          $ref: common.yaml#/$defs/uuid
        name:
          $ref: common.yaml#/$defs/mojo_standard_placeholder
        description:
          type: [ 'null', string ]
        created:
          type: string
          format: date-time
        started:
          type: [ 'null', string ]
          format: date-time
        links:
          $ref: common.yaml#/$defs/links
      if:
        properties:
          completed:
            type: 'null'
      then:
        properties:
          completed_status:
            type: 'null'
      else:
        properties:
          completed:
            type: string
            format: date-time
          completed_status:
            enum: [ 'failure', 'success' ]
  BuildUsers:
    type: array
    uniqueItems: true
    minItems: 1
    items:
      type: object
      additionalProperties: false
      required: [ id, name, email, role ]
      properties:
        id:
          $ref: common.yaml#/$defs/uuid
        name:
          type: string
        email:
          $ref: common.yaml#/$defs/email_address
        role:
          $ref: common.yaml#/$defs/role
    contains:
      type: object
      properties:
        role:
          const: admin
  BuildOrganizations:
    type: array
    uniqueItems: true
    items:
      type: object
      additionalProperties: false
      required: [ id, name, description, role, admins ]
      properties:
        id:
          $ref: common.yaml#/$defs/uuid
        name:
          type: string
        description:
          type: [ 'null', string ]
        role:
          $ref: common.yaml#/$defs/role
        admins:
          type: array
          uniqueItems: true
          minItems: 1
          items:
            $ref: '#/$defs/UserTerse'
  JSONSchemaOnDisk:
    $comment: this is the structure for responses from GET /json_schema/[query_params|request|response|common_device_report]/:name only
    contentMediaType: application/schema+json
    allOf:
      - $comment: Here we are essentially adding on to the main "schema" definition defined in the metaschema.
        # hack! we need an $id here in order to use this location as a $recursiveRef target
        $id: /json_schema/response/JSONSchemaOnDisk_recurse
        $recursiveAnchor: true
        $ref: 'https://json-schema.org/draft/2019-09/schema'
        properties:
          $schema:
            const: 'https://json-schema.org/draft/2019-09/schema'
        unevaluatedProperties: false
      - $comment: Here we are adding on additional requirements for the top level schema only.
        type: object
        # $id: the official path, e.g. https://conch.joyent.us/json_schema/request/Foo
        required: [ $id, $schema ]
        properties:
          $id:
            type: string
            format: uri   # never merely a uri-reference

# vim: set sts=2 sw=2 et :
